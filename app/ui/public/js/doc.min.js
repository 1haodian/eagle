var __sortTable_generateFilteredList;!function(){"use strict";function hasContentByPathList(object,content,pathList){for(var i=0;i<pathList.length;i+=1){var path=pathList[i],value=common.getValueByPath(object,path);if((value+"").toUpperCase().indexOf(content)>=0)return!0}return!1}function hasContent(object,content,depth){var i,keys;if(depth=depth||1,!content)return!0;if(depth>10)return!1;if(void 0===object||null===object)return!1;if(isArray(object)){for(i=0;i<object.length;i+=1)if(hasContent(object[i],content,depth+1))return!0}else{if("object"!=typeof object)return(object+"").toUpperCase().indexOf(content)>=0;for(keys=Object.keys(object),i=0;i<keys.length;i+=1){var value=object[keys[i]];if(hasContent(value,content,depth+1))return!0}}return!1}var isArray;isArray="undefined"!=typeof $?$.isArray:Array.isArray,__sortTable_generateFilteredList=function(list,search,order,orderAsc,searchPathList){var i,_list,_search=(search+"").toUpperCase();if(search)if(_list=[],searchPathList)for(i=0;i<list.length;i+=1)hasContentByPathList(list[i],_search,searchPathList)&&_list.push(list[i]);else for(i=0;i<list.length;i+=1)hasContent(list[i],_search)&&_list.push(list[i]);else _list=list;return order&&common.array.doSort(_list,order,orderAsc),_list}}(),function(){"use strict";function merge(obj1,obj2){$.each(obj2,function(key,value){var oriValue=obj1[key];"object"!=typeof oriValue||"object"!=typeof value||common.isEmpty(value)?obj1[key]=value:merge(oriValue,value)})}var scope={};"undefined"!=typeof window?scope=window:"undefined"!=typeof self&&(scope=self);var common=scope.common={};common.template=function(str,list){return $.each(list,function(key,value){var _regex=new RegExp("\\$\\{"+key+"\\}","g");str=str.replace(_regex,value)}),str},common.getValueByPath=function(unit,path,defaultValue){if(null===unit||void 0===unit)throw"Unit can't be empty!";if(""===path||null===path||void 0===path)return unit;"string"==typeof path&&(path=path.replace(/\[(\d+)\]/g,".$1").replace(/^\./,"").split(/\./));for(var i=0;i<path.length;i+=1)if(unit=unit[path[i]],null===unit||void 0===unit){unit=null;break}return null===unit&&void 0!==defaultValue&&(unit=defaultValue),unit},common.setValueByPath=function(unit,path,value){function _nextPath(array){var _key=path.slice(_start,_end);_inArray&&(_key=_key.slice(0,-1)),_unit[_key]||(array?_unit[_key]=[]:_unit[_key]={}),_unit=_unit[_key]}if(!unit||"string"!=typeof path||""===path)throw"Unit or path can't be empty!";for(var _inArray=!1,_end=0,_start=0,_unit=unit;_end<path.length;_end+=1)"."===path[_end]?(_nextPath(!1),_start=_end+1,_inArray=!1):"["===path[_end]&&(_nextPath(!0),_start=_end+1,_inArray=!0);return _unit[path.slice(_start,_inArray?-1:_end)]=value,unit},common.parseJSON=function(str,defaultVal){if(str&&Number(str).toString()!==str)try{return str=(str+"").trim(),JSON.parse(str)}catch(err){}return 1===arguments.length&&console.warn("Can't parse JSON: "+str),void 0===defaultVal?null:defaultVal},common.stringify=function(json){return JSON.stringify(json,function(key,value){if(!/^(_|\$)/.test(key))return value})},common.isEmpty=function(val){return $.isArray(val)?0===val.length:null===val||void 0===val},common.extend=function(target,origin){return $.each(origin,function(key,value){/^(_|\$)/.test(key)||(target[key]=value)}),target},common.merge=function(mergedObj){for(var i=1;i<arguments.length;i+=1){var obj=arguments[i];merge(mergedObj,obj)}return mergedObj},common.getKeys=function(obj){return $.map(obj,function(val,key){return key})},common.string={},common.string.safeText=function(str){return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},common.string.capitalize=function(str){return(str+"").replace(/\b\w/g,function(match){return match.toUpperCase()})},common.string.preFill=function(str,key,len){for(str+="",len=len||2;str.length<len;)str=key+str;return str},common.array={},common.array.findIndex=function(val,list,path,findAll,caseSensitive){var _list=[];val=caseSensitive===!1?(val+"").toUpperCase():val;for(var i=0;i<list.length;i+=1){var unit=list[i],_val=common.getValueByPath(unit,path);if(_val=caseSensitive===!1?(_val+"").toUpperCase():_val,_val===val){if(!findAll)return i;_list.push(i)}}return findAll?_list:-1},common.array.find=function(val,list,path,findAll,caseSensitive){var index=common.array.findIndex(val,list,path,findAll,caseSensitive);return findAll?$.map(index,function(index){return list[index]}):index===-1?null:list[index]},common.array.minus=function(list1,list2,path1,path2){3===arguments.length&&(path2=path1);var list=[];return $.each(list1,function(i,item){var val1=common.getValueByPath(item,path1);common.array.find(val1,list2,path2)||list.push(item)}),list},common.array.remove=function(val,list,path){return $.grep(list,function(obj){return common.getValueByPath(obj,path)!==val})},common.array.doSort=function(list,path,asc,sortList){var sortFunc;return sortList=sortList||[],sortFunc=asc!==!1?function(obj1,obj2){var val1=common.getValueByPath(obj1,path),val2=common.getValueByPath(obj2,path),index1=common.array.findIndex(val1,sortList),index2=common.array.findIndex(val2,sortList);return index1!==-1&&index2===-1?-1:index1==-1&&index2!==-1?1:index1!==-1&&index2!==-1?index1-index2:val1===val2?0:null===val1||void 0===val1||val1<val2?-1:1}:function(obj1,obj2){var val1=common.getValueByPath(obj1,path),val2=common.getValueByPath(obj2,path),index1=common.array.findIndex(val1,sortList),index2=common.array.findIndex(val2,sortList);return index1!==-1&&index2===-1?-1:index1==-1&&index2!==-1?1:index1!==-1&&index2!==-1?index1-index2:val1===val2?0:null===val1||void 0===val1||val1<val2?1:-1},list.sort(sortFunc)},common.deferred={},common.deferred.all=function(deferredList){function doCheck(){rest-=1,0===rest&&(hasFailure?deferred.reject(failureList):deferred.resolve(successList))}var deferred=$.Deferred(),successList=[],failureList=[],hasFailure=!1,rest=deferredList.length;return $.each(deferredList,function(i,deferred){if(deferred&&deferred.then){var promise=deferred.then(function(data){successList[i]=data},function(data){failureList[i]=data,hasFailure=!0});promise.always?promise.always(doCheck):promise.finally&&promise.finally(doCheck)}else successList[i]=deferred,doCheck()}),deferred},common.number={},common.number.isNumber=function(num){return"number"==typeof num&&!isNaN(num)},common.number.parse=function(num){return num=Number(num),isNaN(num)&&(num=0),num},common.number.toFixed=function(num,fixed){return common.number.isNumber(num)?(num=Number(num),num.toFixed(fixed||0)):"-"},common.number.format=function(num,fixed){return common.number.isNumber(num)?common.number.toFixed(num,fixed).replace(/\B(?=(\d{3})+(?!\d))/g,","):"-"},common.number.abbr=function(number,isByte,digits){digits=digits||2;var decPlaces=Math.pow(10,digits),abbrev=isByte?["KB","MB","GB","TB","PB","EB","ZB","YB"]:["K","M","B","T","Q"],base=isByte?1024:1e3,sign=number<0?-1:1,unit="";if(number=Math.abs(number),isNaN(number))return"-";for(var i=abbrev.length-1;i>=0;i--){var size=Math.pow(base,i+1);if(size<=number){number=Math.round(number*decPlaces/size)/decPlaces,number===base&&i<abbrev.length-1&&(number=1,i++),unit=abbrev[i];break}}return unit=unit?unit:"",(number*sign).toFixed(digits)+unit},common.number.compare=function(num1,num2){return common.number.isNumber(num1)&&common.number.isNumber(num2)?0===num1?"N/A":(num2-num1)/num1:"-"},common.number.inRange=function(rangList,num){for(var i=0;i<rangList.length-1;i+=1){var start=rangList[i],end=rangList[i+1];if(start<=num&&num<end)return i}return rangList.length-1},common.number.sum=function(list,path){var total=0;return $.each(list,function(i,obj){var value=common.getValueByPath(obj,path);"number"!=typeof value||isNaN(value)||(total+=value)}),total}}(),function(){"use strict";function Module(dependencies){return this.dependencies=dependencies,this.queueList=[],this.routeList=[],this.portalList=[],this.widgetList=[],this.requireRest=0,this.requireDeferred=null,this}var is_chrome=navigator.userAgent.indexOf("Chrome")>-1,is_safari=(navigator.userAgent.indexOf("MSIE")>-1,navigator.userAgent.indexOf("Firefox")>-1,navigator.userAgent.indexOf("Safari")>-1),is_opera=navigator.userAgent.toLowerCase().indexOf("op")>-1;is_chrome&&is_safari&&(is_safari=!1),is_chrome&&is_opera&&(is_chrome=!1),is_safari&&$("body").addClass("safari");var _host="",_app={};localStorage&&(_host=localStorage.getItem("host")||"",_app=common.parseJSON(localStorage.getItem("app"),{})),window._host=function(host){return host&&(_host=host.replace(/[\\\/]+$/,""),localStorage&&localStorage.setItem("host",_host)),_host},window._app=function(appName,viewPath){return arguments.length&&(_app[appName]={viewPath:viewPath},localStorage&&localStorage.setItem("app",JSON.stringify(_app))),_app},window._app.clear=function(){localStorage&&(_app={},localStorage.removeItem("app"))};var _moduleStateId=0,_registerAppList=[],_lastRegisterApp=null,_hookRequireFunc=null;window._TRS=function(){return Module.buildTimestamp||Math.random()},Module.prototype.service=function(){return this.queueList.push({type:"service",args:arguments}),this},Module.prototype.directive=function(){return this.queueList.push({type:"directive",args:arguments}),this},Module.prototype.controller=function(){return this.queueList.push({type:"controller",args:arguments}),this},Module.prototype.portal=function(portal,isSite){return this.portalList.push({portal:portal,isSite:isSite}),this},Module.prototype.route=function(state,config){if(1===arguments.length&&(config=state,state="_APPLICATION_STATE_"+_moduleStateId++),!config.url)throw"Url not defined!";return this.routeList.push({state:state,config:config}),this},Module.prototype.widget=function(name,renderFunc,isSite){return this.widgetList.push({widget:{name:name,renderFunc:renderFunc},isSite:isSite}),this},Module.prototype.require=function(scriptURL){var _this=this;_this.requireRest+=1,_this.requireDeferred||(_this.requireDeferred=$.Deferred()),setTimeout(function(){$.getScript(_this.baseURL+"/"+scriptURL).then(function(){_hookRequireFunc?_hookRequireFunc(_this):console.error("Hook function not set!",_this)}).always(function(){_hookRequireFunc=null,_this.requireRest-=1,_this.requireCheck()})},0)},Module.prototype.requireCSS=function(styleURL){var _this=this;setTimeout(function(){$("<link/>",{rel:"stylesheet",type:"text/css",href:_this.baseURL+"/"+styleURL+"?_="+_TRS()}).appendTo("head")},0)},Module.prototype.requireCheck=function(){0===this.requireRest&&this.requireDeferred.resolve()},Module.prototype.getInstance=function(moduleName){var _this=this,deferred=$.Deferred(),module=angular.module(moduleName,this.dependencies);return $.when(this.requireDeferred).always(function(){$.each(_this.queueList,function(i,item){var type=item.type,args=Array.prototype.slice.apply(item.args);"controller"===type&&(args[0]=moduleName+"_"+args[0]),module[type].apply(module,args)});var routeList=$.map(_this.routeList,function(route){var config=route.config=$.extend({},route.config);config.site&&(config.url="/site/:siteId/"+config.url.replace(/^[\\\/]/,""));var parser=document.createElement("a");return parser.href=_this.baseURL+"/"+config.templateUrl,parser.search=parser.search?parser.search+"&_="+window._TRS():"?_="+window._TRS(),config.templateUrl=parser.href,"string"==typeof config.controller&&(config.controller=moduleName+"_"+config.controller),route});$.each(_this.portalList,function(i,config){config.portal.application=moduleName}),$.each(_this.widgetList,function(i,config){config.widget.application=moduleName}),deferred.resolve({application:moduleName,portalList:_this.portalList,routeList:routeList,widgetList:_this.widgetList})}),deferred},window.register=function(dependencies){return $.isArray(dependencies)?_lastRegisterApp=new Module(dependencies):"function"==typeof dependencies&&(_hookRequireFunc=function(module){dependencies(module)}),_lastRegisterApp},$(function(){console.info("[Eagle] Application initialization..."),$.get(_host+"/rest/apps/providers").then(function(res){var promiseList=$.map(res.data||[],function(oriApp){var deferred=$.Deferred(),viewPath=common.getValueByPath(_app,[oriApp.type,"viewPath"],oriApp.viewPath);if(viewPath){var url=viewPath;url=url.replace(/^[\\\/]/,"").replace(/[\\\/]$/,""),$.getScript(url+"/index.js").then(function(){_lastRegisterApp?(_registerAppList.push(oriApp.type),_lastRegisterApp.baseURL=url,_lastRegisterApp.getInstance(oriApp.type).then(function(module){deferred.resolve(module)})):(console.error("Application not register:",oriApp.type),deferred.resolve())},function(){console.error("Load application failed:",oriApp.type,viewPath),deferred.resolve()}).always(function(){_lastRegisterApp=null})}else deferred.resolve();return deferred});common.deferred.all(promiseList).then(function(moduleList){moduleList=$.map(moduleList,function(module){return module});var routeList=$.map(moduleList,function(module){return module.routeList}),portalList=$.map(moduleList,function(module){return module.portalList}),widgetList=$.map(moduleList,function(module){return module.widgetList});$(document).trigger("APPLICATION_READY",{appList:_registerAppList,moduleList:moduleList,routeList:routeList,portalList:portalList,widgetList:widgetList})})})})}();var app={};!function(){"use strict";$(document).on("APPLICATION_READY",function(event,register){function routeResolve(config){var resolve={};return config===!1?resolve:(config=$.extend({auth:!0,site:!0,application:!0},config),config.auth,resolve.Site=function(Site){return Site.getPromise(config)},resolve.Application=function(Application){return Application.getPromise()},resolve._router=function(Site,$wrapState,$q){var name=state_next.name,siteId=param_next.siteId;return!siteId||"site"===name||Site.getPromise(config).then(function(){var match=!1;if($.each(common.getValueByPath(Site.find(siteId),["applicationList"]),function(i,app){var appType=app.descriptor.type,module=modules[appType];if(module)return common.array.find(name,module.routeList,["state"])?(match=!0,!1):void 0}),!match)return console.log("[Application] No route match:",name),$wrapState.go("site",{siteId:siteId}),$q.reject(!1)})},resolve.Time=function(Time){return Time.getPromise(config,state_next,param_next)},resolve)}console.info("[Eagle] Angular bootstrap...");var state_next,state_current,param_next,param_current,STATE_NAME_MATCH=/^[^.]*/,modules={};$.each(register.moduleList,function(i,module){modules[module.application]=module});var eagleApp=angular.module("eagleApp",["ngRoute","ngAnimate","ui.router","eagleControllers","eagle.service"].concat(register.appList));eagleApp.config(function($stateProvider,$urlRouterProvider,$httpProvider,$animateProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"partials/home.html?_="+window._TRS(),controller:"homeCtrl",resolve:routeResolve()}).state("setup",{url:"/setup",templateUrl:"partials/setup.html?_="+window._TRS(),controller:"setupCtrl",resolve:routeResolve({site:!1,application:!1})}).state("alertList",{url:"/alerts",templateUrl:"partials/alert/list.html?_="+window._TRS(),controller:"alertListCtrl",resolve:routeResolve()}).state("policyList",{url:"/policies",templateUrl:"partials/alert/policyList.html?_="+window._TRS(),controller:"policyListCtrl",resolve:routeResolve()}).state("streamList",{url:"/streams",templateUrl:"partials/alert/streamList.html?_="+window._TRS(),controller:"alertStreamListCtrl",resolve:routeResolve()}).state("policyCreate",{url:"/policy/create",templateUrl:"partials/alert/policyEdit/main.html?_="+window._TRS(),controller:"policyCreateCtrl",resolve:routeResolve()}).state("policyEdit",{url:"/policy/edit/{name}",templateUrl:"partials/alert/policyEdit/main.html?_="+window._TRS(),controller:"policyEditCtrl",resolve:routeResolve()}).state("alertDetail",{url:"/alert/detail/{alertId}",templateUrl:"partials/alert/detail.html?_="+window._TRS(),controller:"alertDetailCtrl",resolve:routeResolve()}).state("policyDetail",{url:"/policy/detail/{name}",templateUrl:"partials/alert/policyDetail.html?_="+window._TRS(),controller:"policyDetailCtrl",resolve:routeResolve()}).state("integration",{abstract:!0,url:"/integration/",templateUrl:"partials/integration/main.html?_="+window._TRS(),controller:"integrationCtrl",resolve:routeResolve(!1)}).state("integration.siteList",{url:"siteList",templateUrl:"partials/integration/siteList.html?_="+window._TRS(),controller:"integrationSiteListCtrl",resolve:routeResolve({application:!1})}).state("integration.site",{url:"site/:id",templateUrl:"partials/integration/site.html?_="+window._TRS(),controller:"integrationSiteCtrl",resolve:routeResolve({application:!1})}).state("integration.applicationList",{url:"applicationList",templateUrl:"partials/integration/applicationList.html?_="+window._TRS(),controller:"integrationApplicationListCtrl",resolve:routeResolve({application:!1})}).state("site",{url:"/site/:siteId",templateUrl:"partials/site/home.html?_="+window._TRS(),controller:"siteCtrl",resolve:routeResolve()}),$.each(register.routeList,function(i,route){var config=$.extend({},route.config),resolve={},resolveConfig={};route.config.resolve&&$.each(route.config.resolve,function(key,value){"function"==typeof value?resolve[key]=value:resolveConfig[key]=value}),config.resolve=$.extend(routeResolve(resolveConfig),resolve),$stateProvider.state(route.state,config)})}),eagleApp.controller("MainCtrl",function($scope,$wrapState,$urlRouter,PageConfig,Portal,Widget,Entity,Site,Application,UI,Time,Policy){window._WrapState=$scope.$wrapState=$wrapState,window._PageConfig=$scope.PageConfig=PageConfig,window._Portal=$scope.Portal=Portal,window._Widget=$scope.Widget=Widget,window._Entity=$scope.Entity=Entity,window._Site=$scope.Site=Site,window._Application=$scope.Application=Application,window._UI=$scope.UI=UI,window._Time=$scope.Time=Time,window._Policy=$scope.Policy=Policy,$scope.common=common,$scope._TRS=window._TRS(),Object.defineProperty(window,"scope",{get:function(){var ele=$("#content .nav-tabs-custom.ng-scope .ng-scope[ui-view], #content .ng-scope[ui-view]").last();return angular.element(ele).scope()}}),$scope.$on("$stateChangeStart",function(event,next,nextParam,current,currentParam){console.log("[Switch] current ->",current,currentParam),console.log("[Switch] next ->",next,nextParam),state_next=next||{},state_current=current||{},param_next=nextParam,param_current=currentParam;var currentName=(current||{}).name||"",nextName=(next||{}).name||"";currentName.match(STATE_NAME_MATCH)[0]!==nextName.match(STATE_NAME_MATCH)[0]&&PageConfig.reset()}),$scope.$on("$stateChangeSuccess",function(event){var _innerSearch=Time._innerSearch;Time._innerSearch=null,_innerSearch&&setTimeout(function(){$wrapState.go(".",$.extend({},$wrapState.param,_innerSearch),{location:"replace",notify:!1})},0),console.log("[Switch] done ->",event)}),$scope.getNavClass=function(portal){var path=(portal.path||"").replace(/^#/,"");return $wrapState.path()===path?"active":""},$scope.customizeTimeRange=function(){$("#eagleStartTime").val(Time.format("startTime")),$("#eagleEndTime").val(Time.format("endTime")),$("#eagleTimeRangeMDL").modal()},$scope.setLastDuration=function(hours){var endTime=new Time,startTime=endTime.clone().subtract(hours,"hours");Time.timeRange(startTime,endTime)},$scope.updateTimeRange=function(){var startTime=Time.verifyTime($("#eagleStartTime").val()),endTime=Time.verifyTime($("#eagleEndTime").val());startTime&&endTime?(Time.timeRange(startTime,endTime),$("#eagleTimeRangeMDL").modal("hide")):alert("Time range not validate")},$.each(register.portalList,function(i,config){Portal.register(config.portal,config.isSite)}),$.each(register.widgetList,function(i,config){Widget.register(config.widget,config.isSite)})}),angular.element(document).ready(function(){console.info("[Eagle] UI start..."),angular.bootstrap(document,["eagleApp"]),$("body").removeClass("ng-init-lock"),$("#appLoadTip").remove()})})}(),function(){"use strict";angular.module("eagle.service",[])}(),function(){"use strict";var UNITS=[["days","day","day"],["hours","hr","hr"],["minutes","min","min"],["seconds","s","s"]],keepTime=!1,serviceModule=angular.module("eagle.service");serviceModule.service("Time",function($q,$wrapState){var startTime,endTime,reloadListenerList=[],$Time=function(time){var _mom;if(1===arguments.length&&void 0===time)return null;switch(time){case"startTime":return startTime;case"endTime":return endTime;case"month":_mom=new moment,_mom.utcOffset($Time.UTC_OFFSET),_mom.date(1).hours(0).minutes(0).seconds(0).millisecond(0);break;case"monthEnd":_mom=$Time("month").add(1,"month").subtract(1,"s");break;case"week":_mom=new moment,_mom.utcOffset($Time.UTC_OFFSET),_mom.weekday(0).hours(0).minutes(0).seconds(0).millisecond(0);break;case"weekEnd":_mom=$Time("week").add(7,"d").subtract(1,"s");break;case"day":_mom=new moment,_mom.utcOffset($Time.UTC_OFFSET),_mom.hours(0).minutes(0).seconds(0).millisecond(0);break;case"dayEnd":_mom=$Time("day").add(1,"d").subtract(1,"s");break;case"hour":_mom=new moment,_mom.utcOffset($Time.UTC_OFFSET),_mom.minutes(0).seconds(0).millisecond(0);break;case"hourEnd":_mom=$Time("hour").add(1,"h").subtract(1,"s");break;default:"string"==typeof time&&(isNaN(+time)?(time=new moment(time),time.add(time.utcOffset(),"minutes")):time=+time),_mom=new moment(time),_mom.utcOffset($Time.UTC_OFFSET)}return _mom};return $Time.TIME_RANGE_PICKER="timeRange",$Time.pickerType=null,$Time._reloadListenerList=reloadListenerList,$Time.UTC_OFFSET=0,$Time.FORMAT="YYYY-MM-DD HH:mm:ss",$Time.SHORT_FORMAT="MM-DD HH:mm",$Time.format=function(time,format){return time=$Time(time),time?time.format(format||$Time.FORMAT):"-"},$Time.startTime=function(){return startTime},$Time.endTime=function(){return endTime},$Time.timeRange=function(startTimeValue,endTimeValue){startTime=$Time(startTimeValue),endTime=$Time(endTimeValue),keepTime=!0,$wrapState.go(".",$.extend({},$wrapState.param,{startTime:$Time.format(startTime),endTime:$Time.format(endTime)}),{notify:!1}),$.each(reloadListenerList,function(i,listener){listener($Time)})},$Time.onReload=function(func,$scope){reloadListenerList.push(func),$scope&&$scope.$on("$destroy",function(){$Time.offReload(func)})},$Time.offReload=function(func){reloadListenerList=$.grep(reloadListenerList,function(_func){return _func!==func})},$Time.verifyTime=function(str,format){format=format||$Time.FORMAT;var date=$Time(str);return str===$Time.format(date,format)?date:null},$Time.diff=function(from,to){return from=$Time(from),to=$Time(to),from&&to?to.diff(from):null},$Time.diffStr=function(from,to){var diff=from;if(2===arguments.length&&(diff=$Time.diff(from,to)),null===diff)return"-";if(0===diff)return"0s";var match=!1,rows=[],duration=moment.duration(diff),rest=3;return $.each(UNITS,function(i,unit){var interval=Math.floor(duration[unit[0]]());if(interval>0&&(match=!0),match&&(0!==interval&&rows.push(interval+(interval>1?unit[1]:unit[2])),rest-=1,0===rest))return!1}),rows.join(", ")},$Time.diffInterval=function(from,to){var timeDiff=$Time.diff(from,to);return timeDiff<=216e5?3e5:timeDiff<=864e5?9e5:timeDiff<=6048e5?18e5:timeDiff<=12096e5?36e5:864e5},$Time.align=function(time,interval,ceil){if(time=$Time(time),!time)return null;var func=ceil?Math.ceil:Math.floor,timestamp=time.valueOf();return $Time(func(timestamp/interval)*interval)},$Time.millionFormat=function(num){if(!num)return"-";num=Math.floor(num/1e3);var s=num%60;num=Math.floor(num/60);var m=num%60;num=Math.floor(num/60);var h=num%60;return common.string.preFill(h,"0")+":"+common.string.preFill(m,"0")+":"+common.string.preFill(s,"0")},$Time.getPromise=function(config,state,param){var deferred=$q.defer();return keepTime?(keepTime=!1,deferred.resolve($Time)):(config.time===!0?($Time.pickerType=$Time.TIME_RANGE_PICKER,startTime=$Time.verifyTime(param.startTime),endTime=$Time.verifyTime(param.endTime),startTime&&endTime||(endTime=$Time(),startTime=endTime.clone().subtract(2,"hour"),keepTime=!0,$Time._innerSearch={startTime:$Time.format(startTime),endTime:$Time.format(endTime)})):($Time._innerSearch=null,$Time.pickerType=null),deferred.resolve($Time)),deferred.promise},$Time})}(),function(){"use strict";var serviceModule=angular.module("eagle.service");serviceModule.service("PageConfig",function(){function PageConfig(){}return PageConfig.reset=function(){PageConfig.title="",PageConfig.subTitle="",PageConfig.navPath=[],PageConfig.hideTitle=!1},PageConfig}),serviceModule.service("Portal",function($wrapState,Site,Application){function checkSite(){return 0!==Site.list.length}function checkApplication(){return checkSite()&&0!==Application.list.length}function convertSitePortal(site,portal){return portal=$.extend({},portal,{path:portal.path?"#/site/"+site.siteId+"/"+portal.path.replace(/^[\\\/]/,""):null}),portal.list&&(portal.list=$.map(portal.list,function(portal){return convertSitePortal(site,portal)})),portal}var defaultPortalList=[{name:"Home",icon:"home",path:"#/"},{name:"Alert",icon:"bell",showFunc:checkApplication,list:[{name:"Alerts",path:"#/alerts"},{name:"Policies",path:"#/policies"},{name:"Streams",path:"#/streams"},{name:"Define Policy",path:"#/policy/create"}]}],adminPortalList=[{name:"Integration",icon:"puzzle-piece",showFunc:checkSite,list:[{name:"Sites",path:"#/integration/siteList"},{name:"Applications",path:"#/integration/applicationList"}]}],Portal={},mainPortalList=[],sitePortalList=[],connectedMainPortalList=[],sitePortals={},backHome={name:"Back",icon:"arrow-left",path:"#/"};return Portal.register=function(portal,isSite){(isSite?sitePortalList:mainPortalList).push(portal)},Portal.refresh=function(){connectedMainPortalList=defaultPortalList.concat(adminPortalList);var siteList=$.map(Site.list,function(site){return{name:site.siteName||site.siteId,path:"#/site/"+site.siteId}});connectedMainPortalList.push({name:"Sites",icon:"server",showFunc:checkApplication,list:siteList}),sitePortals={},$.each(Site.list,function(i,site){var siteHome={name:site.siteName||site.siteId+" Home",icon:"home",path:"#/site/"+site.siteId};sitePortals[site.siteId]=[backHome,siteHome].concat($.map(sitePortalList,function(portal){var hasApp=!!common.array.find(portal.application,site.applicationList,"descriptor.type");if(hasApp)return convertSitePortal(site,portal)}))})},Object.defineProperty(Portal,"list",{get:function(){var match=$wrapState.path().match(/^\/site\/([^\/]*)/);return match&&match[1]?sitePortals[match[1]]:connectedMainPortalList}}),Site.onReload(Portal.refresh),Portal.refresh(),Portal})}(),function(){"use strict";var serviceModule=angular.module("eagle.service");serviceModule.service("Widget",function($wrapState,Site,Application){var Widget={},mainWidgetList=[],siteWidgetList=[],displayWidgetList=[],siteWidgets={};return Widget.register=function(widget,isSite){(isSite?siteWidgetList:mainWidgetList).push(widget)},Widget.refresh=function(){displayWidgetList=$.map(mainWidgetList,function(widget){var hasApp=!!common.array.find(widget.application,Application.list,"descriptor.type");if(hasApp)return widget}),siteWidgets={},$.each(Site.list,function(i,site){siteWidgets[site.siteId]=$.map(siteWidgetList,function(widget){var hasApp=!!common.array.find(widget.application,site.applicationList,"descriptor.type");if(hasApp)return widget})})},Object.defineProperty(Widget,"list",{get:function(){var site=Site.current();return site?site.siteId?siteWidgets[site.siteId]:(console.warn("Can't find current site id."),[]):displayWidgetList}}),Site.onReload(Widget.refresh),Widget.refresh(),Widget})}(),function(){"use strict";var serviceModule=angular.module("eagle.service");serviceModule.service("$wrapState",function($state,$location,$stateParams){var $wrapState={},_targetState=null,_targetPriority=0;return $wrapState.go=function(state,param,option,priority){return setTimeout(function(){_targetState=null,_targetPriority=0}),"object"!=typeof param?(priority=param,param={},option={}):"object"!=typeof option&&(priority=option,option={}),priority=priority===!0?1:priority||0,_targetPriority>priority?(console.log("[Wrap State] Go - low priority:",state,"(Skip)"),!1):_targetState!==state||priority?($state.current&&$state.current.name===state&&angular.equals($state.params,param)?(console.log("[Wrap State] Go reload.",$state),$state.reload()):(console.log("[Wrap State] Go:",state,param,priority),$state.go(state,param,option)),_targetState=state,_targetPriority=priority,!0):(console.log("[Wrap State] Go:",state,"(Ignored)"),!1)},$wrapState.reload=function(){console.log("[Wrap State] Do reload."),$state.reload()},$wrapState.path=function(path){return void 0!==path&&console.log("[Wrap State][Deprecated] Switch path:",path),$location.path(path)},$wrapState.url=function(url){return void 0!==url&&console.log("[Wrap State] Switch url:",url),$location.url(url)},Object.defineProperties($wrapState,{origin:{get:function(){return $state}},current:{get:function(){return $state.current}},param:{get:function(){return $.extend({},$location.search(),$stateParams)}},state:{get:function(){return $state}}}),$wrapState.search=$location.search.bind($location),$wrapState.$location=$location,$wrapState})}(),function(){"use strict";var serviceModule=angular.module("eagle.service"),_host="";localStorage&&(_host=localStorage.getItem("host")||""),serviceModule.service("Entity",function($http,$q){function Entity(){}function wrapList(list,promise){return list._done=!1,list._promise=promise.then(function(res){var data=res.data;return list.splice(0),Array.prototype.push.apply(list,data.data),list._done=!0,res}),withThen(list)}function withThen(list){return list._then=list._promise.then.bind(list._promise),list}return Entity._host=function(host){return console.warn("This function only used for development usage."),host&&(_host=host.replace(/[\\\/]+$/,""),localStorage&&localStorage.setItem("host",_host)),_host},Entity.query=function(url,param){var list=[];return list._refresh=function(){var config={};return param&&(config.params=param),wrapList(list,$http.get(_host+"/rest/"+url,config))},list._refresh()},Entity.create=Entity.post=function(url,entity){var list=[];return wrapList(list,$http({method:"POST",url:_host+"/rest/"+url,headers:{"Content-Type":"application/json"},data:entity}))},Entity.delete=function(url,uuid){var list=[];return wrapList(list,$http({method:"DELETE",url:_host+"/rest/"+url,headers:{"Content-Type":"application/json"},data:{uuid:uuid}}))},Entity.merge=function(oriList,tgtList){oriList=oriList||[];var list=[].concat(oriList);return list._done=tgtList._done,list._refresh=tgtList._refresh,list._promise=tgtList._promise,list._promise.then(function(){list.splice(0),Array.prototype.push.apply(list,tgtList),list._done=!0}),list=withThen(list)},Entity.queryMetadata=function(url,param){function process(){metaList._then(function(res){var data=res.data;$.isArray(data)||(data=[data]),metaList.splice(0),Array.prototype.push.apply(metaList,data)})}var metaList=Entity.query("metadata/"+url,param),_refresh=metaList._refresh;return metaList._refresh=function(){_refresh(),process()},process(),metaList},Entity.deleteMetadata=function(url){return{_promise:$http.delete(_host+"/rest/metadata/"+url).then(function(res){console.log(res)})}},Entity})}(),function(){"use strict";var serviceModule=angular.module("eagle.service");serviceModule.service("Site",function($q,$wrapState,Entity,Application){function linkApplications(siteList,ApplicationList){$.each(siteList,function(i,site){var applications=common.array.find(site.siteId,ApplicationList,"site.siteId",!0);$.each(applications,function(i,app){app.descriptor=app.descriptor||{};var oriApp=Application.providers[app.descriptor.type];Object.defineProperty(app,"origin",{configurable:!0,get:function(){return oriApp}})}),Object.defineProperties(site,{applicationList:{configurable:!0,get:function(){return applications}}})})}var Site={},reloadListenerList=[];return Site.list=[],Site.reload=function(){var list=Site.list=Entity.query("sites");return list._promise.then(function(){linkApplications(list,Application.list),$.each(reloadListenerList,function(i,listener){
listener(Site)})}),Site},Site.onReload=function(func){reloadListenerList.push(func)},Site.find=function(siteId){return common.array.find(siteId,Site.list,"siteId")},Site.current=function(){return Site.find($wrapState.param.siteId)},Site.switchSite=function(site){var param=$wrapState.param;site?param.siteId?$wrapState.go($wrapState.current.name,$.extend({},param,{siteId:site.siteId})):$wrapState.go("site",{siteId:site.siteId}):$wrapState.go("home")},Site.getPromise=function(config){var siteList=Site.list;return $q.all([siteList._promise,Application.getPromise()]).then(function(){return config&&config.site!==!1&&0===siteList.length?($wrapState.go("setup",1),$q.reject(Site)):config&&config.application!==!1&&0===Application.list.length?($wrapState.go("integration.site",{id:siteList[0].siteId},1),$q.reject(Site)):Site})},Application.onReload(function(){Site.reload()}),Site.reload(),Site})}(),function(){"use strict";var serviceModule=angular.module("eagle.service");serviceModule.service("Application",function($q,$wrapState,Entity){var Application={},reloadListenerList=[];return Application.list=[],Application.find=function(type,site){return $.grep(Application.list,function(app){return app.descriptor.type===type&&(!site||app.site.siteId===site)})},Application.reload=function(){return Application.list=Entity.query("apps"),Application.list._then(function(){$.each(reloadListenerList,function(i,listener){listener(Application)})}),Application},Application.onReload=function(func){reloadListenerList.push(func)},Application.providers={},Application.providerList=Entity.query("apps/providers"),Application.providerList._promise.then(function(){$.each(Application.providerList,function(i,oriApp){Application.providers[oriApp.type]=oriApp})}),Application.findProvider=function(type){var provider=common.array.find(type,Application.providerList,["type"]);if(provider)return provider;var app=common.array.find(type,Application.list,["appId"]);return app&&app.descriptor?common.array.find(app.descriptor.type,Application.providerList,["type"]):null},Application.getPromise=function(){return Application.list._promise.then(function(){return Application})},Application.reload(),Application})}(),function(){"use strict";function wrapPromise(promise){var retFunc=function(notifyFunc,resolveFunc,rejectFunc){promise.then(resolveFunc,rejectFunc,function(holder){notifyFunc(holder.entity,holder.closeFunc,holder.unlock)})};return retFunc.then=promise.then,retFunc}var serviceModule=angular.module("eagle.service");serviceModule.service("UI",function($rootScope,$q,$compile){function UI(){}function _bindShortcut($dialog){$dialog.on("keydown",function(event){13===event.which&&($(":focus").is("textarea")||$dialog.find(".confirmBtn:enabled").click())})}function _fieldDialog(create,name,entity,fieldList,checkFunc){var _deferred,$mdl,$scope,_entity=entity||{};return _deferred=$q.defer(),$scope=$rootScope.$new(!0),$scope.name=name,$scope.entity=_entity,$scope.fieldList=fieldList.concat(),$scope.checkFunc=checkFunc,$scope.lock=!1,$scope.create=create,$scope.config="object"==typeof name?name:{},entity||$.each(fieldList,function(i,field){field.defaultValue&&(_entity[field.field]=field.defaultValue)}),$mdl=$(TMPL_FIELDS).appendTo("body"),$compile($mdl)($scope),$mdl.modal(),setTimeout(function(){$mdl.find("input, select").filter(":visible:first:enabled").focus()},500),$mdl.on("hide.bs.modal",function(){_deferred.reject()}),$mdl.on("hidden.bs.modal",function(){_deferred.resolve({entity:_entity}),$mdl.remove(),$(".modal-backdrop").length&&$("body").addClass("modal-open")}),$scope.getFieldDescription=function(field){return"function"==typeof field.description?field.description($scope.entity):field.description||(field.name||field.field)+"..."},$scope.emptyFieldList=function(){return $.map(fieldList,function(field){if(!field.optional&&!_entity[field.field])return field.field})},$scope.newField=function(){UI.fieldConfirm({title:"New Field"},null,[{field:"field",name:"Field Name"}])(function(entity,closeFunc,unlock){common.array.find(entity.field,$scope.fieldList,"field")?($.dialog({title:"OPS",content:"Field already exist!"}),unlock()):($scope.fieldList.push({field:entity.field,_customize:!0}),closeFunc())})},$scope.removeField=function(field){$scope.fieldList=common.array.remove(field,$scope.fieldList)},$scope.confirm=function(){$scope.lock=!0,_deferred.notify({entity:_entity,closeFunc:function(){$mdl.modal("hide")},unlock:function(){$scope.lock=!1}})},_bindShortcut($mdl),_deferred.promise}return UI.createConfirm=function(name,entity,fieldList,checkFunc){return wrapPromise(_fieldDialog(!0,name,entity,fieldList,checkFunc))},UI.fieldConfirm=function(config,entity,fieldList,checkFunc){return wrapPromise(_fieldDialog("field",config,entity,fieldList,checkFunc))},UI.deleteConfirm=function(name){var _deferred,$mdl,$scope;return _deferred=$q.defer(),$scope=$rootScope.$new(!0),$scope.name=name,$scope.lock=!1,$mdl=$(TMPL_DELETE).appendTo("body"),$compile($mdl)($scope),$mdl.modal(),$mdl.on("hide.bs.modal",function(){_deferred.reject()}),$mdl.on("hidden.bs.modal",function(){_deferred.resolve({name:name}),$mdl.remove(),$(".modal-backdrop").length&&$("body").addClass("modal-open")}),$scope.delete=function(){$scope.lock=!0,_deferred.notify({name:name,closeFunc:function(){$mdl.modal("hide")},unlock:function(){$scope.lock=!1}})},wrapPromise(_deferred.promise)},UI});var TMPL_FIELDS='<div class="modal fade" tabindex="-1" role="dialog"><div class="modal-dialog" ng-class="{\'modal-lg\': config.size === \'large\'}" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">{{config.title || (create ? "New" : "Update") + " " + name}}</h4></div><div class="modal-body"><div class="form-group" ng-repeat="field in fieldList" ng-switch="field.type"><label for="featureName"><span ng-if="!field.optional && !field._customize">*</span> <a ng-if="field._customize" class="fa fa-times" ng-click="removeField(field)"></a> {{field.name || field.field}}</label><textarea class="form-control" placeholder="{{getFieldDescription(field)}}" ng-model="entity[field.field]" rows="{{ field.rows || 10 }}" ng-readonly="field.readonly" ng-disabled="lock" ng-switch-when="blob"></textarea><select class="form-control" ng-model="entity[field.field]" ng-init="entity[field.field] = entity[field.field] || field.valueList[0]" ng-switch-when="select"><option ng-repeat="value in field.valueList">{{value}}</option></select><input type="text" class="form-control" placeholder="{{getFieldDescription(field)}}" ng-model="entity[field.field]" ng-readonly="field.readonly" ng-disabled="lock" ng-switch-default></div><a ng-if="config.addable" ng-click="newField()">+ New field</a></div><div class="modal-footer"><p class="pull-left text-danger">{{checkFunc(entity)}}</p><button type="button" class="btn btn-default" data-dismiss="modal" ng-disabled="lock">Close</button><button type="button" class="btn btn-primary confirmBtn" ng-click="confirm()" ng-disabled="checkFunc(entity) || emptyFieldList().length || lock" ng-if="config.confirm !== false">{{config.confirmDesc || (create ? "Create" : "Update")}}</button></div></div></div></div>',TMPL_DELETE='<div class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">Delete Confirm</h4></div><div class="modal-body"><span class="text-red fa fa-exclamation-triangle pull-left" style="font-size: 50px;"></span><p>You are <strong class="text-red">DELETING</strong> \'{{name}}\'!</p><p>Proceed to delete?</p></div><div class="modal-footer"><button type="button" class="btn btn-danger" ng-click="delete()" ng-disabled="lock">Delete</button><button type="button" class="btn btn-default" data-dismiss="modal" ng-disabled="lock">Cancel</button></div></div></div></div>'}(),function(){"use strict";var serviceModule=angular.module("eagle.service");serviceModule.service("Policy",function($q,UI,Entity){return{publisherTypes:{"org.apache.eagle.alert.engine.publisher.impl.AlertEmailPublisher":{name:"Email",displayFields:["recipients"],fields:["subject","template","sender","recipients"]},"org.apache.eagle.alert.engine.publisher.impl.AlertKafkaPublisher":{name:"Kafka",displayFields:["topic"],fields:["topic","kafka_broker"]},"org.apache.eagle.alert.engine.publisher.impl.AlertSlackPublisher":{name:"Slack",displayFields:["channels"],fields:["token","channels","severitys","urltemplate"]},"org.apache.eagle.alert.engine.publisher.impl.AlertEagleStorePlugin":{name:"Storage",displayFields:[],fields:[]}},delete:function(policy){var deferred=$q.defer();return UI.deleteConfirm(policy.name)(function(entity,closeFunc){Entity.deleteMetadata("policies/"+policy.name)._promise.finally(function(){closeFunc(),deferred.resolve()})},function(){deferred.reject()}),deferred.promise},start:function(policy){return Entity.post("metadata/policies/"+encodeURIComponent(policy.name)+"/status/ENABLED",{})._promise},stop:function(policy){return Entity.post("metadata/policies/"+encodeURIComponent(policy.name)+"/status/DISABLED",{})._promise}}})}(),function(){"use strict";angular.module("eagle.components",[])}(),function(){"use strict";var eagleComponents=angular.module("eagle.components");eagleComponents.directive("sortTable",function($compile){return{restrict:"AE",scope:!0,priority:1001,controller:function($scope,$element,$attrs){function setState(bool){$attrs.isSorting&&($scope.$parent[$attrs.isSorting]=bool)}function workMessage(event){var data=event.data;worker_id===data.id&&(setState(!1),cacheFilteredList=data.list,$scope.$apply())}var sortmatch,worker,worker_id=0;"undefined"!=typeof Worker&&(worker=new Worker("public/js/worker/sortTableWorker.js?_="+window._TRS())),$scope.pageNumber=1,$scope.pageSize=10,$scope.maxSize=10,$scope.search="",$scope.orderKey="",$scope.orderAsc=!0,$attrs.sortpath&&(sortmatch=$attrs.sortpath.match(/^(-)?(.*)$/),sortmatch[1]&&($scope.orderAsc=!1),$scope.orderKey=sortmatch[2]),$scope.doSort=function(path){$scope.orderKey===path?$scope.orderAsc=!$scope.orderAsc:($scope.orderKey=path,$scope.orderAsc=!0)},$scope.checkSortClass=function(key){return $scope.orderKey===key?"fa sort-mark "+($scope.orderAsc?"fa-sort-asc":"fa-sort-desc"):"fa fa-sort sort-mark"};var cacheSearch="",cacheOrder="",cacheOrderAsc=null,cacheFilteredList=null;$scope.getFilteredList=function(){if(cacheSearch!==$scope.search||cacheOrder!==$scope.orderKey||cacheOrderAsc!==$scope.orderAsc||!cacheFilteredList){cacheSearch=$scope.search,cacheOrder=$scope.orderKey,cacheOrderAsc=$scope.orderAsc;var fullList=$scope.$parent[$attrs.sortTable]||[];if(cacheFilteredList||(cacheFilteredList=fullList),worker){worker_id+=1,setState(!0);var list=JSON.stringify(fullList);worker.postMessage({search:cacheSearch,order:cacheOrder,orderAsc:cacheOrderAsc,searchPathList:$scope.$parent[$attrs.searchPathList],list:list,id:worker_id})}else cacheFilteredList=__sortTable_generateFilteredList(fullList,cacheSearch,cacheOrder,cacheOrderAsc,$scope.$parent[$attrs.searchPathList]),setState(!1)}return cacheFilteredList},$scope.$watch($attrs.sortTable+".length",function(){cacheFilteredList=null}),$scope.$watch($attrs.sortTable+".___SORT_TABLE___",function(){var fullList=$scope.$parent[$attrs.sortTable];fullList&&!fullList.___SORT_TABLE___&&(fullList.___SORT_TABLE___=+new Date,cacheFilteredList=null)}),worker.addEventListener("message",workMessage),$scope.$on("$destroy",function(){worker.removeEventListener("message",workMessage)}),$attrs.scope&&($scope.$parent[$attrs.scope]=$scope)},compile:function($element){var contents=$element.contents().remove();return{post:function($scope,$element){$scope.defaultPageSizeList=[10,25,50,100],$element.append(contents);var $toolContainer=$('<div class="tool-container clearfix"></div>').insertBefore($element.find("table")),$search=$('<div class="search-box"><input type="search" class="form-control input-sm" placeholder="Search" ng-model="search" /><span class="fa fa-search" /></div>').appendTo($toolContainer);$compile($search)($scope);var $pageSize=$('<div class="page-size">Show<select class="form-control" ng-model="pageSize" convert-to-number><option ng-repeat="size in pageSizeList || defaultPageSizeList track by $index">{{size}}</option></select>Entities</div>').appendTo($toolContainer);$compile($pageSize)($scope),$element.find("table [sortpath]").each(function(){var $this=$(this),_sortpath=$this.attr("sortpath");$this.attr("ng-click","doSort('"+_sortpath+"')"),$this.prepend("<span ng-class=\"checkSortClass('"+_sortpath+"')\"></span>"),$compile($this)($scope)});var $tr=$element.find("table [ts-repeat], table > tbody > tr").filter(":first");$tr.attr("ng-repeat","item in getFilteredList().slice((pageNumber - 1) * pageSize, pageNumber * pageSize) track by $index"),$compile($tr)($scope);var $navigation=$('<div class="navigation-bar clearfix"><span>show {{(pageNumber - 1) * pageSize + 1}} to {{pageNumber * pageSize}} of {{getFilteredList().length}} items</span><uib-pagination total-items="getFilteredList().length" ng-model="pageNumber" boundary-links="true" items-per-page="pageSize" max-size="maxSize"></uib-pagination></div>').appendTo($element);$compile($navigation)($scope)}}}}}),eagleComponents.directive("convertToNumber",function(){return{require:"ngModel",link:function(scope,element,attrs,ngModel){ngModel.$parsers.push(function(val){return parseInt(val,10)}),ngModel.$formatters.push(function(val){return""+val})}}})}(),function(){"use strict";var eagleComponents=angular.module("eagle.components");eagleComponents.service("Chart",function(){return{color:["#0073b7","#dd4b39","#00a65a","#f39c12","#605ca8","#001F3F","#39CCCC","#D81B60","#3c8dbc","#f56954","#00c0ef","#3D9970","#FF851B","#01FF70","#F012BE"],charts:{}}}),eagleComponents.directive("chart",function(Chart){function chartResize(){setTimeout(function(){$.each(charts,function(id,chart){chart.resize()})},310)}var charts=Chart.charts;return $(window).resize(chartResize),$("body").on("expanded.pushMenu collapsed.pushMenu",chartResize),{restrict:"AE",scope:{title:"@?title",series:"=",category:"=?category",categoryFunc:"=?categoryFunc",xTitle:"@?xTitle",yTitle:"@?yTitle",option:"=?option",click:"=?ngClick",chart:"@?chart"},controller:function($scope,$element,$attrs,Time){function refreshChart(){var maxYAxis=0,legendList=[],categoryList=$scope.category?$scope.category:[],seriesList=$.map($scope.series||[],function(series,id){return 0!==id||$scope.category||(categoryList=$.map(series.data,function(point){return $scope.categoryFunc?$scope.categoryFunc(point.x):Time.format(point.x,"HH:mm")})),legendList.push(series.name),series.yAxisIndex&&(maxYAxis=Math.max(series.yAxisIndex,maxYAxis)),$.extend({},series,{data:$scope.category?series.data:$.map(series.data,function(point){return point.y})})}),yAxis=[];for(i=0;i<=maxYAxis;i+=1)yAxis.push({name:$scope.yTitle,type:"value"});var option={color:Chart.color.concat(),title:[{text:$scope.title}],tooltip:{trigger:"axis"},legend:[{data:legendList}],grid:{top:"30",left:"0",right:"0",bottom:"0",containLabel:!0},xAxis:{name:$scope.xTitle,type:"category",data:categoryList,axisTick:{show:!1}},yAxis:yAxis,series:seriesList};$scope.option&&(option=common.merge(option,$scope.option)),chart.setOption(option)}var i,lastTooltipEvent,chart=echarts.init($element[0]);charts[chart.id]=chart;var chartClick=!1;chart.on("click",function(e){$scope.click&&$scope.click(e)&&refreshChart(),chartClick=!0}),chart.getZr().on("click",function(){!chartClick&&$scope.click&&$scope.click($.extend({componentType:"tooltip"},lastTooltipEvent))&&refreshChart(),chartClick=!1}),chart.on("showtip",function(e){lastTooltipEvent=e}),$attrs.chart&&($scope.$parent.$parent[$attrs.chart]=chart),chart.refresh=function(){refreshChart()},refreshChart(),$scope.$watch("series",refreshChart),$scope.$on("$destroy",function(){delete charts[chart.id],chart.dispose(),delete $scope.$parent.$parent[$attrs.chart]})},template:"<div>Loading...</div>",replace:!0}})}(),function(){"use strict";var eagleComponents=angular.module("eagle.components");eagleComponents.directive("widget",function($compile,Site){return{restrict:"AE",priority:1001,controller:function($scope,$element,$attrs){},compile:function($element){return $element.contents().remove(),{post:function($scope,$element){var widget=$scope.widget;$scope.site=Site.current(),widget.renderFunc?widget.renderFunc($element,$scope,$compile)!==!1&&$compile($element.contents())($scope):$element.append("Widget don't provide render function:"+widget.application+" - "+widget.name)}}}}})}(),function(){"use strict";var eagleComponents=angular.module("eagle.components");eagleComponents.directive("staticInclude",function($http,$templateCache,$compile){return function(scope,element,attrs){var templatePath=attrs.staticInclude;$http.get(templatePath,{cache:$templateCache}).success(function(response){var contents=element.html(response).contents();$compile(contents)(scope)})}})}(),function(){"use strict";var eagleComponents=angular.module("eagle.components");eagleComponents.directive("editor",function(){return{restrict:"AE",require:"ngModel",link:function($scope,$element,$attrs,$ctrl){function updateScope(value){clearTimeout(updateId),updateId=setTimeout(function(){$ctrl.$setViewValue(value)},0)}$element.innerHeight(21*Number($attrs.rows||10));var updateId,editLock=!1,editor=ace.edit($element[0]),session=editor.getSession();editor.container.style.lineHeight=1.5,editor.setOptions({fontSize:"14px"}),editor.setTheme("ace/theme/tomorrow"),editor.$blockScrolling=1/0,editor.getSession().on("change",function(event){editLock=!0;var value=session.getValue();updateScope(value)}),session.setUseWorker(!1),session.setUseWrapMode(!0),session.setMode("ace/mode/sql"),$scope.$watch($attrs.ngModel,function(newValue){return editLock?void(editLock=!1):void session.setValue(newValue||"")}),$scope.$on("$destroy",function(){editor.destroy()})},template:'<div class="form-control"></div>',replace:!0}})}(),function(){"use strict";var eagleComponents=angular.module("eagle.components");eagleComponents.directive("naBlock",function(){return{scope:{naBlock:"="},restrict:"AE",transclude:!0,template:'<div><span ng-if="naBlock && naBlock !== true">{{naBlock}}</span><code ng-if="!naBlock">N/A</code><div ng-if="naBlock === true" ng-transclude></div></div>',replace:!0}})}(),function(){"use strict";angular.module("eagleControllers",["ui.bootstrap","eagle.components","eagle.service"])}(),function(){"use strict";var eagleControllers=angular.module("eagleControllers");eagleControllers.controller("homeCtrl",function($scope,$wrapState,PageConfig){PageConfig.title="Home",$scope.colorList=["bg-aqua","bg-green","bg-yellow","bg-red"]}),eagleControllers.controller("setupCtrl",function($wrapState,$scope,PageConfig,Entity,Site){PageConfig.hideTitle=!0,$scope.lock=!1,$scope.siteId="sandbox",$scope.siteName="Sandbox",$scope.description="",$scope.createSite=function(){$scope.lock=!0,Entity.create("sites",{siteId:$scope.siteId,siteName:$scope.siteName,description:$scope.description})._then(function(){Site.reload(),$wrapState.go("home")},function(res){$.dialog({title:"OPS!",content:res.message})}).finally(function(){$scope.lock=!1})}})}(),function(){"use strict";var eagleControllers=angular.module("eagleControllers");eagleControllers.controller("alertListCtrl",function($scope,$wrapState,$interval,PageConfig,Entity){PageConfig.title="Alerts",$scope.displayType="raw",$scope.alertList=Entity.queryMetadata("alerts",{size:1e4});var refreshInterval=$interval($scope.alertList._refresh,1e4);$scope.$on("$destroy",function(){$interval.cancel(refreshInterval)})}),eagleControllers.controller("alertDetailCtrl",function($scope,$wrapState,PageConfig,Entity){PageConfig.title="Alert Detail",$scope.alertList=Entity.queryMetadata("alerts/"+encodeURIComponent($wrapState.param.alertId)),$scope.alertList._then(function(){$scope.alert=$scope.alertList[0],$scope.alert||$.dialog({title:"OPS",content:"Alert '"+$wrapState.param.alertId+"' not found!"})})}),eagleControllers.controller("alertStreamListCtrl",function($scope,$wrapState,PageConfig,Application,Entity){PageConfig.title="Streams",$scope.streamList=[],Entity.queryMetadata("streams")._then(function(res){$scope.streamList=$.map(res.data,function(stream){var application=Application.findProvider(stream.dataSource);return $.extend({application:application},stream)})}),$scope.dataSources={},Entity.queryMetadata("datasources")._then(function(res){$.each(res.data,function(i,dataSource){$scope.dataSources[dataSource.name]=dataSource})}),$scope.showDataSource=function(stream){var dataSource=$scope.dataSources[stream.dataSource];$.dialog({title:dataSource.name,content:$("<pre class='text-break'>").html(JSON.stringify(dataSource,null,"\t")),size:"large"})}}),eagleControllers.controller("policyListCtrl",function($scope,$wrapState,PageConfig,Entity,Policy){function updateList(){var list=Entity.queryMetadata("policies");list._then(function(){$scope.policyList=list})}PageConfig.title="Policies",$scope.policyList=[],updateList(),$scope.deletePolicy=function(policy){Policy.delete(policy).then(updateList)},$scope.startPolicy=function(policy){Policy.start(policy).then(updateList)},$scope.stopPolicy=function(policy){Policy.stop(policy).then(updateList)}}),eagleControllers.controller("policyDetailCtrl",function($scope,$wrapState,$interval,PageConfig,Entity,Policy){function updatePolicy(){var policyName=$wrapState.param.name,encodePolicyName=encodeURIComponent(policyName),policyList=Entity.queryMetadata("policies/"+encodePolicyName);policyList._promise.then(function(){return $scope.policy=policyList[0],console.log("[Policy]",$scope.policy),$scope.policy?void Entity.post("metadata/policies/parse",$scope.policy.definition.value)._then(function(res){$scope.executionPlan=res.data}):void $.dialog({title:"OPS",content:"Policy '"+$wrapState.param.name+"' not found!"},function(){$wrapState.go("policyList")})}),$scope.policyPublisherList=Entity.queryMetadata("policies/"+encodePolicyName+"/publishments/"),Entity.queryMetadata("schedulestates")._then(function(res){var schedule=res.data||{};$scope.assignment=common.array.find(policyName,schedule.assignments,["policyName"])||{};var queueList=$.map(schedule.monitoredStreams,function(stream){return stream.queues});$scope.queue=common.array.find($scope.assignment.queueId,queueList,["queueId"])})}PageConfig.title="Policy",PageConfig.subTitle="Detail",PageConfig.navPath=[{title:"Policy List",path:"/policies"},{title:"Detail"}],$scope.tab="setting",$scope.displayType="raw",$scope.setTab=function(tab){$scope.tab=tab},updatePolicy(),$scope.alertList=Entity.queryMetadata("policies/"+encodeURIComponent($wrapState.param.name)+"/alerts",{size:1e3}),$scope.deletePolicy=function(){Policy.delete($scope.policy).then(function(){$wrapState.go("policyList")})},$scope.startPolicy=function(){Policy.start($scope.policy).then(updatePolicy)},$scope.stopPolicy=function(){Policy.stop($scope.policy).then(updatePolicy)};var refreshInterval=$interval($scope.alertList._refresh,6e4);$scope.$on("$destroy",function(){$interval.cancel(refreshInterval)})})}(),function(){"use strict";function connectPolicyEditController(entity,args){var newArgs=[entity];Array.prototype.push.apply(newArgs,args),policyEditController.apply(this,newArgs)}function policyEditController(policy,$scope,$q,$wrapState,$timeout,PageConfig,Entity,Policy){function autoDescription(){$scope.autoPolicyDescription&&($scope.policy.description="Policy for "+$scope.policy.outputStreams.join(", "))}$scope.publisherTypes=Policy.publisherTypes,$scope.policy=policy,$scope.policy=common.merge({name:"",description:"",inputStreams:[],outputStreams:[],definition:{type:"siddhi",value:""},alertDefinition:{subject:"",body:"",severity:"WARNING",category:"DEFAULT"},partitionSpec:[],parallelismHint:5},$scope.policy),console.log("[Policy]",$scope.policy);var cacheSearchType,cacheSearchSourceKey,searchApplications;$scope.searchType="app",$scope.searchSourceKey="",$scope.applications={},$scope.newPolicy=!$scope.policy.name,$scope.autoPolicyDescription=$scope.newPolicy&&!$scope.policy.description,PageConfig.navPath=[{title:"Policy List",path:"/policies"},{title:($scope.newPolicy?"Define":"Update")+" Policy"}],$scope.sourceTab="all",$scope.setSourceTab=function(tab){$scope.sourceTab=tab},$scope.getSearchApplication=function(){if(cacheSearchSourceKey!==$scope.searchSourceKey.toUpperCase()||cacheSearchType!==$scope.searchType){var match=!1;cacheSearchSourceKey=$scope.searchSourceKey.toUpperCase(),cacheSearchType=$scope.searchType,searchApplications={},$.each($scope.applications,function(appName,streams){$.each(streams,function(i,stream){var groupName="app"===cacheSearchType?stream.dataSource:stream.siteId;if(groupName.toUpperCase().indexOf(cacheSearchSourceKey)>=0||stream.streamId.toUpperCase().indexOf(cacheSearchSourceKey)>=0){match=!0;var group=searchApplications[groupName]=searchApplications[groupName]||[];group.push(stream)}})}),match||(searchApplications=null)}return searchApplications},$scope.streams={},$scope.streamList=Entity.queryMetadata("streams"),$scope.streamList._then(function(){$scope.applications={},cacheSearchSourceKey=null,$.each($scope.streamList,function(i,stream){var list=$scope.applications[stream.dataSource]=$scope.applications[stream.dataSource]||[];list.push(stream),$scope.streams[stream.streamId]=stream})}),$scope.isInputStreamSelected=function(streamId){return $.inArray(streamId,$scope.policy.inputStreams)>=0};var checkPromise;$scope.definitionMessage="",$scope.checkDefinition=function(){$timeout.cancel(checkPromise),checkPromise=$timeout(function(){Entity.post("metadata/policies/parse",$scope.policy.definition.value)._then(function(res){var data=res.data;if(console.log(data),data.success){if($scope.definitionMessage="",data.policyExecutionPlan){$scope.policy.inputStreams=$.map(data.policyExecutionPlan.inputStreams,function(value,stream){return stream});var outputStreams=$.map(data.policyExecutionPlan.outputStreams,function(value,stream){return stream});$scope.policy.outputStreams=outputStreams.concat(),$scope.outputStreams=outputStreams,autoDescription(),$scope.policy.partitionSpec=data.policyExecutionPlan.streamPartitions}}else $scope.definitionMessage=data.message})},350)},$scope.outputStreams=($scope.policy.outputStreams||[]).concat(),$scope.isOutputStreamSelected=function(streamId){return $.inArray(streamId,$scope.policy.outputStreams)>=0},$scope.checkOutputStream=function(streamId){$scope.isOutputStreamSelected(streamId)?$scope.policy.outputStreams=common.array.remove(streamId,$scope.policy.outputStreams):$scope.policy.outputStreams.push(streamId),autoDescription()},$scope.partition={},$scope.addPartition=function(){$scope.partition={streamId:$scope.policy.inputStreams[0],type:"GROUPBY",columns:[]},$(".modal[data-id='partitionMDL']").modal()},$scope.newPartitionCheckColumn=function(column){return $.inArray(column,$scope.partition.columns)>=0},$scope.newPartitionClickColumn=function(column){$scope.newPartitionCheckColumn(column)?$scope.partition.columns=common.array.remove(column,$scope.partition.columns):$scope.partition.columns.push(column)},$scope.addPartitionConfirm=function(){$scope.policy.partitionSpec.push($scope.partition)},$scope.removePartition=function(partition){$scope.policy.partitionSpec=common.array.remove(partition,$scope.policy.partitionSpec)},$scope.publisherList=Entity.queryMetadata("publishments"),$scope.addPublisherType="",$scope.policyPublisherList=[],$scope.publisher={},$scope.newPolicy||Entity.queryMetadata("policies/"+$scope.policy.name+"/publishments/")._then(function(res){$scope.policyPublisherList=$.map(res.data,function(publisher){return $.extend({_exist:!0},publisher)})}),$scope.addPublisher=function(){$scope.publisher={existPublisher:$scope.publisherList[0],type:"org.apache.eagle.alert.engine.publisher.impl.AlertEmailPublisher",dedupIntervalMin:"PT1M",serializer:"org.apache.eagle.alert.engine.publisher.impl.StringEventSerializer",properties:{}},$scope.publisherList.length?$scope.addPublisherType="exist":$scope.addPublisherType="new",$(".modal[data-id='publisherMDL']").modal()},$scope.removePublisher=function(publisher){$scope.policyPublisherList=common.array.remove(publisher,$scope.policyPublisherList)},$scope.checkPublisherName=function(){return!!common.array.find($scope.publisher.name,$scope.publisherList.concat($scope.policyPublisherList),["name"])&&"'"+$scope.publisher.name+"' already exist"},$scope.addPublisherConfirm=function(){"exist"===$scope.addPublisherType&&($scope.publisher=$.extend({_exist:!0},$scope.publisher.existPublisher));var properties={};$.each(Policy.publisherTypes[$scope.publisher.type].fields,function(i,field){properties[field]=$scope.publisher.properties[field]||""}),$scope.policyPublisherList.push($.extend({},$scope.publisher,{properties:properties}))},$scope.saveLock=!1,$scope.saveCheck=function(){return!$scope.saveLock&&$scope.policy.name&&common.number.parse($scope.policy.parallelismHint)>0&&$scope.policy.definition.value&&$scope.policy.outputStreams.length&&$scope.policyPublisherList.length},$scope.saveConfirm=function(){$scope.saveLock=!0,Entity.post("metadata/policies/validate",$scope.policy)._then(function(res){var validate=res.data;if(console.log(validate),!validate.success)return $.dialog({title:"OPS",content:validate.message}),void($scope.saveLock=!1);var publisherPromiseList=$.map($scope.policyPublisherList,function(publisher){if(!publisher._exist)return Entity.create("metadata/publishments",publisher)._promise});publisherPromiseList.length&&console.log("Creating publishers...",$scope.policyPublisherList),$q.all(publisherPromiseList).then(function(){console.log("Create publishers success..."),Entity.create("metadata/policies",$scope.policy)._then(function(){console.log("Create policy success..."),Entity.post("metadata/policies/"+$scope.policy.name+"/publishments/",$.map($scope.policyPublisherList,function(publisher){return publisher.name}))._then(function(){$.dialog({title:"Done",content:"Close dialog to go to the policy detail page."},function(){$wrapState.go("policyDetail",{name:$scope.policy.name})})},function(res){$.dialog({title:"OPS",content:"Link publishers failed:"+res.data.message})}).finally(function(){$scope.policyLock=!1})},function(res){$.dialog({title:"OPS",content:"Create policy failed: "+res.data.message}),$scope.policyLock=!1})},function(args){$.dialog({title:"OPS",content:"Create publisher failed. More detail please check output in 'console'."}),console.log("Create publishers failed:",args),$scope.policyLock=!1})},function(){$scope.saveLock=!1})}}var eagleControllers=angular.module("eagleControllers");eagleControllers.controller("policyCreateCtrl",function($scope,$q,$wrapState,$timeout,PageConfig,Entity,Policy){PageConfig.title="Define Policy",connectPolicyEditController({},arguments)}),eagleControllers.controller("policyEditCtrl",function($scope,$q,$wrapState,$timeout,PageConfig,Entity,Policy){PageConfig.title="Edit Policy";var args=arguments;$scope.policyList=Entity.queryMetadata("policies/"+encodeURIComponent($wrapState.param.name)),$scope.policyList._promise.then(function(){var policy=$scope.policyList[0];policy?connectPolicyEditController(policy,args):$.dialog({title:"OPS",content:"Policy '"+$wrapState.param.name+"' not found!"},function(){$wrapState.go("policyList")})})})}(),function(){"use strict";var eagleControllers=angular.module("eagleControllers");eagleControllers.controller("integrationCtrl",function($scope,$wrapState,PageConfig){PageConfig.title="Integration",$scope.getState=function(){return $wrapState.current.name}}),eagleControllers.controller("integrationSiteListCtrl",function($scope,$wrapState,PageConfig,UI,Entity,Site){PageConfig.title="Integration",PageConfig.subTitle="Site",$scope.deleteSite=function(site){
UI.deleteConfirm(site.siteId)(function(entity,closeFunc,unlock){Entity.delete("sites",site.uuid)._then(function(res){Site.reload(),closeFunc()},function(res){$.dialog({title:"OPS",content:common.getValueByPath(res,["data","message"])}),unlock()})})},$scope.newSite=function(){UI.createConfirm("Site",{},[{field:"siteId",name:"Site Id"},{field:"siteName",name:"Display Name",optional:!0},{field:"description",name:"Description",optional:!0,type:"blob",rows:5}])(function(entity,closeFunc,unlock){Entity.create("sites",entity)._then(function(){Site.reload(),closeFunc()},unlock)})}}),eagleControllers.controller("integrationSiteCtrl",function($sce,$scope,$wrapState,$interval,PageConfig,Entity,UI,Site,Application){function mapApplications(){Site.getPromise().then(function(){$scope.site=Site.find($wrapState.param.id);var uninstalledApplicationList=common.array.minus(Application.providerList,$scope.site.applicationList,"type","descriptor.type");$scope.applicationList=common.array.doSort($.map($scope.site.applicationList,function(app){return app.installed=!0,app}),["origin","name"]).concat(common.array.doSort($.map(uninstalledApplicationList,function(oriApp){return{origin:oriApp}}),["origin","name"]))})}if(PageConfig.title="Site",PageConfig.subTitle=$wrapState.param.id,$scope.site=Site.find($wrapState.param.id),!$scope.site)return void $.dialog({title:"OPS",content:"Site not found!"},function(){$wrapState.go("integration.siteList")});console.log("[Site]",$scope.site),$scope.siteName=$scope.site.siteId+($scope.site.siteName?"("+$scope.site.siteName+")":""),mapApplications();var refreshApplications=$scope.refreshApplications=function(){Application.reload().getPromise().then(mapApplications)};$scope.getAppStatusClass=function(application){switch((application.status||"").toUpperCase()){case"INITIALIZED":return"primary";case"STARTING":return"warning";case"RUNNING":return"success";case"STOPPING":return"warning";case"STOPPED":return"danger"}return"default"},$scope.getStartedAppCount=function(){return $.grep($scope.site.applicationList,function(app){return $.inArray((app.status||"").toUpperCase(),["STARTING","RUNNING"])>=0}).length},$scope.showAppDetail=function(application){$("a[data-id='introTab']").click(),$scope.tmpApp=application,application=application.origin;var docs=application.docs||{install:"",uninstall:""};$scope.application=application,$scope.installHTML=$sce.trustAsHtml(docs.install),$scope.uninstallHTML=$sce.trustAsHtml(docs.uninstall),$("#appMDL").modal()},$scope.tmpApp={},$scope.generalFields=[],$scope.advancedFields=[],$scope.customizeFields=[],$scope.installLock=!1,$scope.newField=function(){UI.fieldConfirm({title:"New Property"},null,[{field:"name",name:"Property Name"},{field:"value",name:"Property Value",optional:!0}])(function(entity,closeFunc,unlock){var fullList=$scope.generalFields.concat($scope.advancedFields).concat($scope.customizeFields);common.array.find(entity.name,fullList,"field")?($.dialog({title:"OPS",content:"Property already exist!"}),unlock()):($scope.customizeFields.push({name:entity.name,_customize:!0,required:!0}),$scope.tmpApp.configuration[entity.name]=entity.value,closeFunc())})},$scope.removeField=function(field){$scope.customizeFields=common.array.remove(field,$scope.customizeFields),delete $scope.tmpApp.configuration[field.name]},$scope.checkJarPath=function(){var jarPath=($scope.tmpApp||{}).jarPath;/\.jar$/.test(jarPath)?$scope.tmpApp.mode="CLUSTER":/\.class/.test(jarPath)&&($scope.tmpApp.mode="LOCAL")},$scope.collapseCheck=function(){setTimeout(function(){$scope.$apply()},400)},$scope.isCollapsed=function(dataId){return!$("[data-id='"+dataId+"']").hasClass("in")},$scope.checkFields=function(){var pass=!0,config=common.getValueByPath($scope,["tmpApp","configuration"],{});return $.each($scope.generalFields,function(i,field){if(field.required&&!config[field.name])return pass=!1,!1}),pass},$scope.getCustomFields=function(configuration){var fields=common.getValueByPath($scope.application,"configuration.properties",[]).concat();return $.map(configuration||{},function(value,key){if(!common.array.find(key,fields,["name"]))return{name:key,_customize:!0,required:!0}})},$scope.configByJSON=function(){UI.fieldConfirm({title:"Configuration"},{json:JSON.stringify($scope.tmpApp.configuration,null,"\t")},[{field:"json",name:"JSON Configuration",type:"blob"}],function(entity){var json=common.parseJSON(entity.json,!1);if(!json)return"Require JSON format"})(function(entity,closeFunc){$scope.tmpApp.configuration=common.parseJSON(entity.json,{}),$scope.customizeFields=$scope.getCustomFields($scope.tmpApp.configuration),closeFunc()})},$scope.installAppConfirm=function(){$scope.installLock=!0;var uuid=$scope.tmpApp.uuid,app=$.extend({},$scope.tmpApp);delete app.uuid,uuid?Entity.create("apps/"+uuid,app)._then(function(){refreshApplications(),$("#installMDL").modal("hide")},function(res){$.dialog({title:"OPS",content:res.data.message}),$scope.installLock=!1}):Entity.create("apps/install",app)._then(function(){refreshApplications(),$("#installMDL").modal("hide")},function(res){$.dialog({title:"OPS",content:res.data.message}),$scope.installLock=!1})},$scope.installApp=function(application,entity){entity=entity||{},application=application.origin,$scope.installLock=!1,$scope.application=application;var docs=application.docs||{install:"",uninstall:""};$scope.installHTML=$sce.trustAsHtml(docs.install),$scope.tmpApp={mode:"CLUSTER",jarPath:application.jarPath,configuration:{}},entity.uuid||(common.merge($scope.tmpApp,{siteId:$scope.site.siteId,appType:application.type}),$scope.checkJarPath());var fields=common.getValueByPath(application,"configuration.properties",[]).concat();$scope.generalFields=[],$scope.advancedFields=[],$scope.customizeFields=[],$("[data-id='appEnvironment']").attr("class","collapse in").removeAttr("style"),$("[data-id='appGeneral']").attr("class","collapse in").removeAttr("style"),$("[data-id='appAdvanced']").attr("class","collapse").removeAttr("style"),$("[data-id='appCustomize']").attr("class","collapse in").removeAttr("style"),$.each(fields,function(i,field){$scope.tmpApp.configuration[field.name]=common.template(field.value||"",{siteId:$scope.site.siteId,appType:application.type}),field.required?$scope.generalFields.push(field):$scope.advancedFields.push(field)}),common.merge($scope.tmpApp,entity),$scope.customizeFields=$scope.getCustomFields(entity.configuration);var missDep=!1;$.each(application.dependencies,function(i,dep){if(!Application.find(dep.type,$scope.site.siteId)[0])return missDep=!0,!1}),$("#installMDL").modal(),missDep?$("a[data-id='guideTab']").click():$("a[data-id='configTab']").click()},$scope.uninstallApp=function(application){UI.deleteConfirm(application.descriptor.name+" - "+application.site.siteId)(function(entity,closeFunc,unlock){Entity.delete("apps/uninstall",application.uuid)._then(function(){refreshApplications(),closeFunc()},unlock)})},$scope.startApp=function(application){$.dialog({title:"Confirm",content:"Do you want to start '"+application.descriptor.name+"'?",confirm:!0},function(ret){ret&&Entity.post("apps/start",{uuid:application.uuid})._then(function(){refreshApplications()})})},$scope.stopApp=function(application){$.dialog({title:"Confirm",content:"Do you want to stop '"+application.descriptor.name+"'?",confirm:!0},function(ret){ret&&Entity.post("apps/stop",{uuid:application.uuid})._then(function(){refreshApplications()})})},$scope.editApp=function(application){var type=application.descriptor.type,provider=Application.findProvider(type);$scope.installApp({origin:provider},{mode:application.mode,jarPath:application.jarPath,uuid:application.uuid,configuration:$.extend({},application.configuration)})};var refreshInterval=$interval(refreshApplications,6e4);$scope.$on("$destroy",function(){$interval.cancel(refreshInterval)})}),eagleControllers.controller("integrationApplicationListCtrl",function($sce,$scope,$wrapState,PageConfig,Application){PageConfig.title="Integration",PageConfig.subTitle="Applications",$scope.showAppDetail=function(application){var docs=application.docs||{install:"",uninstall:""};$scope.application=application,$scope.installHTML=$sce.trustAsHtml(docs.install),$scope.uninstallHTML=$sce.trustAsHtml(docs.uninstall),$("#appMDL").modal()}})}(),function(){"use strict";var eagleControllers=angular.module("eagleControllers");eagleControllers.controller("siteCtrl",function($scope,PageConfig,Site){var site=Site.current();PageConfig.title=site.siteName||site.siteId,PageConfig.subTitle="home"})}();
//# sourceMappingURL=doc.min.js.map